app/ — código de aplicación (módulos + capas)
├── Application/ — casos de uso y contratos
│   ├── Uploads/ — orquestación de cargas
│   │   ├── Actions/{ReplaceFile.php,UploadFile.php} — casos de uso de carga/reemplazo
│   │   ├── Contracts/{OwnerIdNormalizerInterface.php,UploadOrchestratorInterface.php,UploadRepositoryInterface.php,UploadStorageInterface.php}
│   │   ├── DTO/{ReplacementResult.php,UploadResult.php}
│   │   ├── Exceptions/{InvalidOwnerIdException.php,InvalidUploadFileException.php}
│   │   └── Support/{OwnerIdFormats.php,OwnerIdMode.php}
│   └── User/ — flujo de avatar/usuario
│       ├── Actions/{DeleteAvatar.php,UpdateAvatar.php}
│       ├── Contracts/{UserAvatarRepository.php,UserRepository.php}
│       ├── DTO/{AvatarDeletionResult.php,AvatarUpdateResult.php}
│       ├── Events/{AvatarDeleted.php,AvatarUpdated.php}
│       └── Jobs/{CleanupMediaArtifacts.php,Enums/ConversionReadyState.php}
├── Console/ — comandos artisan
│   ├── Commands/{CleanAuditLogs.php,QuarantineCleanupSidecarsCommand.php,QuarantinePruneCommand.php,TenancyBootstrapExistingUsers.php}
│   └── Kernel.php
├── Domain/ — reglas de dominio
│   ├── Security/Rules/{AvatarHeaderRules.php,RateLimitSignatureRules.php}
│   └── Uploads/{UploadProfile.php,UploadProfileId.php}
├── Http/ — capa HTTP raíz (Inertia/Auth)
│   ├── Controllers/{Controller.php,LanguageController.php}
│   ├── Middleware/{HandleAppearance.php,HandleInertiaRequests.php,PreventBruteForce.php,SanitizeInput.php,SecurityHeaders.php,TrustProxies.php,UserAudit.php}
│   └── Requests/{Auth/LoginRequest.php,Concerns/SanitizesInputs.php,Settings/ProfileUpdateRequest.php}
├── Infrastructure/ — restos técnicos heredados
│   ├── Uploads/README.md — documentación legacy del hub de uploads
│   └── User/ — adaptadores/listeners de usuario (sin cambios recientes)
├── Models/ — modelos Eloquent SSOT
│   ├── Concerns/TracksMediaVersions.php — mapea colecciones de media a columnas de versión
│   ├── MediaCleanupState.php — estado de limpiezas programadas
│   ├── Tenant.php — modelo de tenant
│   ├── Upload.php — modelo de upload
│   └── User.php — modelo de usuario
├── Modules/ — módulos desacoplados
│   ├── Tenancy/ — soporte multi-tenant (middleware, provider, contexto, finder)
│   ├── Uploads/ — módulo completo de media/uploads
│   │   ├── Adapters/{LaravelUploadStorage.php,SpatieMediaResource.php}
│   │   ├── Contracts/{FileConstraints.php,MediaArtifactCollector.php,MediaCleanupScheduler.php,MediaOwner.php,MediaProfile.php,MediaResource.php,MediaUploader.php,UploadedMedia.php}
│   │   ├── Controllers/{DownloadUploadController.php,Media/ShowAvatar.php,Media/ShowMediaController.php,Settings/ProfileAvatarController.php,UploadController.php}
│   │   ├── DTO/{CleanupStatePayload.php,ConversionExpectations.php,MediaReplacementItemSnapshot.php,MediaReplacementResult.php,MediaReplacementSnapshot.php,QueuedUploadResult.php}
│   │   ├── Middleware/{RateLimitUploads.php,TrackMediaAccess.php}
│   │   ├── Orchestrators/{DefaultUploadOrchestrator.php,DocumentUploadGuard.php,MediaProfileResolver.php}
│   │   ├── Paths/{TenantPathGenerator.php,TenantPathLayout.php,MediaLibrary/TenantAwareFileNamer.php,MediaLibrary/TenantAwarePathGenerator.php}
│   │   ├── Pipeline/ — pipeline de uploads
│   │   │   ├── Contracts, DTO, Exceptions, Health
│   │   │   ├── Image/{AvatarConversionProfile.php,Concerns/GuardsUploadedImage.php,FallbackWorkflow.php,ImagePipeline.php,ImagePipelineResult.php,ImageProcessingException.php,ImagickWorkflow.php,PipelineArtifacts.php,PipelineConfig.php,PipelineLogger.php}
│   │   │   ├── ImageUploadPipelineAdapter.php
│   │   │   ├── Jobs/{CleanupAvatarOrphans.php,CleanupMediaArtifactsJob.php,PerformConversionsJob.php,PostProcessAvatarMedia.php,ProcessLatestAvatar.php,ProcessUploadJob.php}
│   │   │   ├── Listeners/{QueueAvatarPostProcessing.php,RunPendingMediaCleanup.php}
│   │   │   ├── Observers/MediaObserver.php
│   │   │   ├── Optimizer/{Adapters/LocalOptimizationAdapter.php,Adapters/RemoteDownloader.php,Adapters/RemoteUploader.php,OptimizerService.php}
│   │   │   ├── Quarantine/{LocalQuarantineRepository.php,QuarantineRepository.php,QuarantineState.php,QuarantineToken.php}
│   │   │   ├── Scanning/{GitYaraRuleManager.php,LaravelCacheScanCircuitStore.php,ScanCircuitBreaker.php,ScanCircuitStoreInterface.php,ScanCoordinator.php,ScanCoordinatorInterface.php,Scanners/AbstractScanner.php,Scanners/ClamAvScanner.php,Scanners/YaraScanner.php,YaraRuleManager.php}
│   │   │   ├── Security/{Exceptions/InvalidRuleException.php,ImageMetadataReader.php,ImageNormalizer.php,Logging/MediaLogSanitizer.php,Logging/MediaSecurityLogger.php,MagicBytesValidator.php,MimeNormalizer.php,PayloadScanner.php,Upload/UploadSecurityLogger.php,Upload/UploadValidationLogger.php}
│   │   │   ├── Services/MediaCleanupScheduler.php
│   │   │   └── Support/{ImageUploadReporter.php,MediaArtifactCollector.php,MediaAttacher.php,MediaCleanupArtifactsBuilder.php,PipelineResultMapper.php,QuarantineManager.php}
│   │   ├── Policies/UploadPolicy.php
│   │   ├── Profiles/{AvatarImageProfile.php,AvatarProfile.php,CertificateSecretProfile.php,DocumentPdfProfile.php,GalleryImageProfile.php,Galler\
|Profile.php,ImportCsvProfile.php,SpreadsheetXlsxProfile.php}
│   │   ├── Providers/{ImagePipelineServiceProvider.php,MediaLibraryBindingsServiceProvider.php,UploadsServiceProvider.php}
│   │   ├── Registry/UploadProfileRegistry.php
│   │   ├── Repositories/EloquentUploadRepository.php
│   │   ├── Requests/{Concerns/UsesDocumentValidation.php,Concerns/UsesImageValidation.php,Concerns/UsesOwnerIdValidation.php,HttpUploadedMedia.php,ReplaceUploadRequest.php,Settings/DeleteAvatarRequest.php,Settings/UpdateAvatarRequest.php,StoreUploadRequest.php,UploadImageRequest.php}
│   │   ├── Rules/SecureImageValidation.php
│   │   ├── Services/{ConfigurableOwnerIdNormalizer.php,MediaReplacementService.php}
│   │   ├── Support/MediaServingResponder.php
│   │   └── Support — helpers varios de serving
│   └── User/Policies/UserPolicy.php — policy de usuario
├── Providers/ — providers raíz de Laravel
│   ├── AppServiceProvider.php
│   ├── AuthServiceProvider.php
│   ├── EventServiceProvider.php
│   └── HtmlPurifierServiceProvider.php
├── Support/ — contratos/adapters/utilidades compartidas
│   ├── Adapters/{LaravelAsyncJobDispatcher.php,LaravelClock.php,LaravelEventBus.php,LaravelLogger.php,LaravelTransactionManager.php}
│   ├── Contracts/{AsyncJobDispatcherInterface.php,ClockInterface.php,EventBusInterface.php,LoggerInterface.php,MetricsInterface.php,TenantContextInterface.php,TransactionManagerInterface.php}
│   ├── Enums/Uploads/{ProcessingMode.php,ScanMode.php,ServingMode.php,UploadKind.php}
│   ├── Localization/TranslationService.php
│   ├── Logging/SecurityLogger.php
│   ├── Media/TenantAwareUrlGenerator.php
│   ├── Metrics/LogMetrics.php
│   ├── Policies/Concerns/{HandlesMediaOwnership.php,HandlesTenantMembership.php}
│   ├── Sanitization/DisplayName.php
│   └── Security/{AvatarHeaderInspector.php,Exceptions/AntivirusException.php,RateLimitSignatureFactory.php,SecurityHelper.php}
└── README.md — guía de arquitectura de app
