# =============================================================================
# üîπ N√öCLEO DE LA APLICACI√ìN
# =============================================================================
APP_NAME="Gestor Autonomos"
APP_ENV=local                                                # PROD: production
APP_KEY=base64:/qpSen0jqDE92c7g669pwy9tUPYEwx1Ilp1Lmh3ZILE= # PROD: (generar) php artisan key:generate
APP_DEBUG=true                                               # PROD: false
APP_URL=http://localhost                                     # PROD: https://app.tudominio.com
APP_LOCALE=es
APP_FALLBACK_LOCALE=es
APP_FAKER_LOCALE=es_ES
APP_MAINTENANCE_DRIVER=file                                  # PROD: redis | file (seg√∫n infra)
# APP_MAINTENANCE_STORE=database
APP_FRONTEND_URL=http://localhost:3000                      # PROD: https://app.tudominio.com
CSP_DEV_IMG_HOSTS="http://127.0.0.1:5174 http://localhost:5174"

PHP_CLI_SERVER_WORKERS=4
BCRYPT_ROUNDS=12

# =============================================================================
# üîπ LOGGING
# =============================================================================
LOG_CHANNEL=stack
LOG_STACK=single                                             # PROD: daily (si rotas logs)
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug                                              # PROD: info | warning

# =============================================================================
# üîπ BASE DE DATOS
# =============================================================================
DB_CONNECTION=pgsql
DB_HOST=pgsql                                                # PROD: host interno (no p√∫blico)
DB_PORT=5432
DB_DATABASE=sail
DB_USERNAME=sail
DB_PASSWORD=password

# =============================================================================
# üîπ CACHE & REDIS
# =============================================================================
CACHE_DRIVER=redis
# CACHE_PREFIX=

REDIS_CLIENT=phpredis
REDIS_HOST=redis
REDIS_PASSWORD=null                                          # PROD: (si aplica) tu_password
REDIS_PORT=6379
REDIS_CACHE_LOCK_CONNECTION=default
REDIS_CACHE_CONNECTION=cache

MEMCACHED_HOST=127.0.0.1
MEMCACHED_PORT=11211

# =============================================================================
# üîπ SESIONES
# =============================================================================
SESSION_LIFETIME=120
SESSION_ENCRYPT=true
SESSION_PATH=/
SESSION_DOMAIN=null                                          # PROD: .tudominio.com (si multi-subdominio)
SESSION_SECURE_COOKIE=false                                  # PROD: true (si usas HTTPS)
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=lax                                        # PROD: lax | none (si cross-site + Secure)
SESSION_INVALIDATE_ON_LOGOUT=true
SESSION_REGENERATE_ON_LOGIN=true
SESSION_REGENERATE_CSRF_ON_LOGOUT=true
SESSION_LOG_SESSIONS=true
SESSION_DRIVER=redis
# =============================================================================
# üîπ QUEUES & JOBS
# =============================================================================
QUEUE_CONNECTION=redis                                       # PROD: redis | sqs
QUEUE_FAILED_DRIVER=database-uuids
QUEUE_FAILED_TABLE=failed_jobs

# Configuraci√≥n database para queues
DB_QUEUE_CONNECTION=${DB_CONNECTION}
DB_QUEUE_TABLE=jobs
DB_QUEUE=default
DB_QUEUE_RETRY_AFTER=90

# Configuraci√≥n Redis para queues
REDIS_QUEUE_CONNECTION=default
REDIS_QUEUE=default
REDIS_QUEUE_RETRY_AFTER=90

# Otros drivers de queue
BEANSTALKD_QUEUE_HOST=localhost                              # PROD: host_beans
BEANSTALKD_QUEUE=default
BEANSTALKD_QUEUE_RETRY_AFTER=90

SQS_PREFIX=https://sqs.us-east-1.amazonaws.com/your-account-id # PROD: tu_prefix_real
SQS_QUEUE=default                                            # PROD: nombre_cola
SQS_SUFFIX=

# Colas espec√≠ficas
QUEUE_DEFAULT=default
QUEUE_MEDIA=media
QUEUE_LOW=low

# =============================================================================
# üîπ BROADCASTING & FILESYSTEM
# =============================================================================
BROADCAST_CONNECTION=log                                     # PROD: redis | pusher (si lo usas)

FILESYSTEM_DISK=public
AVATAR_DISK=public                                           # PROD: s3

# =============================================================================
# üîπ CORREO ELECTR√ìNICO
# =============================================================================
MAIL_MAILER=log                                              # PROD: smtp | ses | mailgun
MAIL_SCHEME=null                                             # PROD: https
MAIL_HOST=127.0.0.1                                          # PROD: smtp.proveedor.com
MAIL_PORT=2525                                               # PROD: 587 | 465
MAIL_USERNAME=null                                           # PROD: usuario_smtp
MAIL_PASSWORD=null                                           # PROD: token/secret
MAIL_FROM_ADDRESS="hello@example.com"                        # PROD: no-reply@tudominio.com
MAIL_FROM_NAME="${APP_NAME}"

# =============================================================================
# üîπ AWS & S3
# =============================================================================
AWS_ACCESS_KEY_ID=                                           # PROD: AKIA****
AWS_SECRET_ACCESS_KEY=                                       # PROD: ********
AWS_DEFAULT_REGION=eu-west-1
AWS_BUCKET=                                                  # PROD: bucket_prod
AWS_USE_PATH_STYLE_ENDPOINT=false                           # PROD: false (S3)
AWS_ENDPOINT=                                                # PROD: (vac√≠o) o tu endpoint MinIO
AWS_URL=                                                     # PROD: https://cdn.tudominio.com

# =============================================================================
# üîπ FRONTEND / VITE / INERTIA
# =============================================================================
VITE_APP_NAME="${APP_NAME}"
VITE_DEV_SERVER_URL=http://127.0.0.1:5175
INERTIA_SSR_ENABLED=false                                    # PROD: true | false (seg√∫n setup)
INERTIA_SSR_URL=http://127.0.0.1:13714                       # PROD: https://ssr.tudominio.com

# =============================================================================
# üîπ SEGURIDAD & AUDITOR√çA
# =============================================================================
AUDIT_SAMPLE_RATE=0.01
AUDIT_RETENTION_DAYS=90                                      # PROD: 180‚Äì365 (seg√∫n pol√≠tica)
AUDIT_LOG_CHANNEL=daily
AUDIT_SECURITY_CHANNEL=security

# Rate Limits
LOGIN_MAX_ATTEMPTS=5
LOGIN_DECAY_MINUTES=15
REGISTER_MAX_ATTEMPTS=3
REGISTER_DECAY_MINUTES=10
PASSWORD_RESET_MAX_ATTEMPTS=3
PASSWORD_RESET_DECAY_MINUTES=10
API_RATE_LIMIT_PER_MINUTE=60                                 # PROD: 60‚Äì120 (seg√∫n plan)
GENERAL_REQUESTS_PER_MINUTE=100                              # PROD: 100‚Äì300 (seg√∫n plan)
LANGUAGE_CHANGE_MAX_ATTEMPTS=5
LANGUAGE_CHANGE_DECAY_MINUTES=5

# Headers de seguridad
API_REQUIRE_HTTPS=false                                     # PROD: true
SECURITY_ENABLE_HSTS=true
SECURITY_ENABLE_FRAME_OPTIONS=true
SECURITY_ENABLE_CONTENT_TYPE_OPTIONS=true
SECURITY_ENABLE_XSS_PROTECTION=true
SECURITY_ENABLE_REFERRER_POLICY=true
SECURITY_ENABLE_PERMISSIONS_POLICY=true
SECURITY_ENABLE_CORP=true
SECURITY_ENABLE_COOP=true
SECURITY_ENABLE_COEP=false                                   # PROD: false | true (si aislas con COEP)
SECURITY_HSTS_MAX_AGE=31536000
SECURITY_CORP_POLICY=same-origin
SECURITY_COOP_POLICY=same-origin
SECURITY_COEP_POLICY=require-corp
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin
SECURITY_PERMISSIONS_POLICY=
SECURITY_DEBUG_CSP=false

# CSP
CSP_IMG_HOSTS="*.s3.amazonaws.com"                          # PROD: cdn.tudominio.com *.s3.eu-west-1.amazonaws.com
CSP_CONNECT_HOSTS=                                           # PROD: https://api.tudominio.com wss://ws.tudominio.com
CSP_REPORT_URI=
CSP_REPORT_TO=
CSP_REPORT_TO_ENDPOINTS=
CSP_REPORT_TO_MAX_AGE=10886400
CSP_REPORT_TO_INCLUDE_SUBDOMAINS=false
CSP_DEV_IMG_HOSTS=
CSP_DEV_CONNECT_HOSTS=

# Proxies
TRUSTED_PROXIES=*                                             # PROD: 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16 o *
TRUSTED_PROXIES_HEADERS=all                                   # PROD: auto | all | x-forwarded-*

# Logs de seguridad
LOG_API_REQUESTS=true
LOG_AUTHENTICATION_EVENTS=true
LOG_FAILED_LOGINS=true
LOG_SUCCESSFUL_LOGINS=true
LOG_PASSWORD_CHANGES=true
LOG_LOGOUTS=true
LOG_USER_ACTIONS=true
LOG_IP_ADDRESSES=true
LOG_USER_AGENTS=true
LOG_SENSITIVE_CHANGES=true
LOG_SESSIONS=true

# =============================================================================
# üîπ MEDIA LIBRARY & FILESYSTEM
# =============================================================================
MEDIA_DISK=public
MEDIA_QUEUE=media
QUEUE_CONVERSIONS_BY_DEFAULT=true
QUEUE_CONVERSIONS_AFTER_DB_COMMIT=true
MEDIA_DOWNLOADER_SSL=true
MEDIA_TEMPORARY_URL_DEFAULT_LIFETIME=5
ENABLE_MEDIA_LIBRARY_VAPOR_UPLOADS=false
MEDIA_PREFIX=
GALLERY_DISK=

# Media Collector
MEDIA_COLLECTOR_CHECK_EXISTS=false
MEDIA_COLLECTOR_LOG_MISSING_DEBUG=true
MEDIA_COLLECTOR_ASSUME_EXIST_FOR_DISKS=s3

# Colecciones
AVATAR_COLLECTION=avatar
GALLERY_COLLECTION=

# =============================================================================
# üîπ PROCESAMIENTO DE IM√ÅGENES
# =============================================================================
IMAGE_DRIVER=imagick

# L√≠mites de archivos
MAX_FILE_SIZE=10                                            # PROD: 10‚Äì25 (seg√∫n plan)
                                

# L√≠mites de imagen
IMG_MAX_BYTES=26214400
IMG_MIN_DIMENSION=128
IMG_MAX_MEGAPIXELS=48
IMG_MAX_EDGE=16384
IMG_UNCOMPRESSED_MAX=536870912
IMG_NORMALIZE=true

# Config intervenci√≥n/driver
IMG_DRIVER=gd
IMG_IMAGICK_REQUIRE_POLICY=true
IMG_IMAGICK_POLICY_PATH=
IMG_IMAGICK_MEMORY_LIMIT=268435456
IMG_IMAGICK_MAP_LIMIT=536870912
IMG_IMAGICK_AREA_LIMIT=134217728
IMG_IMAGICK_FILE_HANDLES=32
IMG_IMAGICK_TIME_LIMIT=60

# Calidad y compresi√≥n
IMG_JPEG_QUALITY=82
IMG_WEBP_QUALITY=82
IMG_ALPHA_TO_WEBP=true
IMG_JPEG_PROGRESSIVE_MIN=1200
IMG_WEBP_METHOD=6
IMG_PNG_COMPRESSION_LEVEL=9
IMG_PNG_COMPRESSION_STRATEGY=1
IMG_PNG_COMPRESSION_FILTER=5
IMG_PNG_EXCLUDE_CHUNK=all

# GIF y animaciones
IMG_PRESERVE_GIF_ANIMATION=false
IMG_MAX_GIF_FRAMES=60
IMG_GIF_RESIZE_FILTER=8

# Colas para procesamiento
IMG_AVATAR_QUEUE_CONVERSIONS=true
IMG_QUEUE_CONVERSIONS_DEFAULT=
IMG_POSTPROCESS_COLLECTIONS=

# Logging y debug
IMG_LOG_CHANNEL=null
IMG_DEBUG=false

# Controla si el escaneo AV se ejecuta (desactivar solo en local)
UPLOAD_SCAN_ENABLED=false

# Escaneo de seguridad
IMG_SCAN_CHUNK_BYTES=262144
IMG_SCAN_MAX_BYTES=4194304
IMG_SCAN_ALLOWED_BASE=/var/www/html/storage/app/private/quarantine
IMG_SCAN_RULES_BASE=/var/www/html/security/yara
IMG_SCAN_MAX_FILE_SIZE=20971520
IMG_IMAGICK_MEMORY_MB=128
IMG_IMAGICK_MAP_MB=256
IMG_IMAGICK_TIME_MS=750

# Antivirus externo
IMG_SCAN_USE_CLAMAV=true
IMG_SCAN_CLAMAV_BIN=/usr/bin/clamscan
IMG_SCAN_BIN_ALLOWLIST=/usr/bin/clamscan
IMG_SCAN_CLAMAV_TIMEOUT=20
IMG_SCAN_CLAMAV_ARGS="--no-summary"

IMG_SCAN_USE_YARA=true
IMG_SCAN_YARA_BIN=/usr/bin/yara
IMG_SCAN_YARA_RULES=/var/www/html/security/yara/images.yar
IMG_SCAN_YARA_TIMEOUT=5
IMG_SCAN_YARA_ARGS="--fail-on-warnings --nothreads"
IMG_SCAN_TIMEOUT_MS=5000
IMG_SCAN_IDLE_TIMEOUT=20
IMG_SCAN_DEBUG_STRICT=false
IMG_SCAN_CIRCUIT_TTL=900
IMG_SCAN_CIRCUIT_CACHE_KEY=image_scan:circuit_failures
IMG_SCAN_CIRCUIT_MAX_FAILS=5
IMG_GD_MEMORY_MB=0
IMG_RATE_DECAY=60 
IMG_RATE_MAX=10
IMG_BOMB_RATIO=100

SCAN_FILES_FOR_MALWARE=false
IMG_SCAN_ENABLED=true

# Si tu config/image-pipeline.php lee esto:
VIRUS_SCANNERS=clamav,yara
IMG_SCAN_STRICT=true

IMG_SCAN_RULES_MAX_BYTES=2097152
IMG_IMAGICK_THREADS=2
IMG_DECODE_TIMEOUT_SECONDS=5
IMG_MAX_GIF_FRAMES=60
IMG_SCAN_BYTES=51200
IMG_MAX_UPLOAD_SIZE=26214400
IMG_QUARANTINE_MAX_SIZE=26214400

# =============================================================================
# üîπ Servido firmado de conversions (desactivado por defecto)
# =============================================================================
MEDIA_SIGNED_SERVE_ENABLED=false
MEDIA_QUARANTINE_DISK=quarantine
MEDIA_SIGNED_SERVE_LIFETIME=5
MEDIA_CLEANUP_TTL_HOURS=48
MEDIA_ALLOWED_DISKS=public,s3

# =============================================================================
# üîπ TRADUCCIONES
# =============================================================================
TRANSLATION_CACHE_HOURS=6
LOCALES_ALLOW_HTML=false

# =============================================================================
# üîπ DYNAMODB
# =============================================================================
DYNAMODB_CACHE_TABLE=cache

# =============================================================================
# üîπ DOCKER SAIL
# =============================================================================
WWWUSER=1000
WWWGROUP=1000

# =============================================================================
# üîπ HERRAMIENTAS MULTIMEDIA
# =============================================================================
FFMPEG_PATH=/usr/bin/ffmpeg
FFPROBE_PATH=/usr/bin/ffprobe
IP_HASH_LENGTH=12
IP_HASH_MODE=masked
